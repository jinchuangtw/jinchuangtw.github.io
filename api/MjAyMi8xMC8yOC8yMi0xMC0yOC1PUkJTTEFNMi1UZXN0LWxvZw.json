{"title":"ORB-SLAM2 Test Log (With KITTI Dataset on ROS)","date":"2022-10-28T06:43:35.000Z","date_formatted":{"ll":"Oct 28, 2022","L":"10/28/2022","MM-DD":"10-28"},"link":"2022/10/28/22-10-28-ORBSLAM2-Test-log","comments":true,"tags":["SLAM"],"categories":["Programming","Research"],"updated":"2022-10-28T06:57:36.675Z","content":"<p>This note shows a brief test process on the open-source code of ORB-SLAM2.</p>\n<span id=\"more\"></span>\n<p><strong>Environment Setup ::</strong></p>\n<ul>\n<li>ubuntu 18.04 LTS</li>\n<li>ROS Melodic</li>\n<li>OpenCv 3.2.0 with contrib module</li>\n<li>Pangolin @ 1ec721d (Github)</li>\n</ul>\n<h2 id=\"download-and-build\">Download and Build<a title=\"#download-and-build\" href=\"#download-and-build\"></a></h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> $(your_catkin_workspace)/src</span><br><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/raulmur/ORB_SLAM2.git</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ORB_SLAM2</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> +x build.sh</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> +x build_ros.sh</span><br><span class=\"line\">./build.sh</span><br><span class=\"line\">./build_ros.sh</span><br></pre></td></tr></table></figure>\n<h3 id=\"building-problems-encountered\">Building Problems Encountered<a title=\"#building-problems-encountered\" href=\"#building-problems-encountered\"></a></h3>\n<h4 id=\"1.-error:-'usleep'-was-not-declared-in-this-scope\">1. Error: ‘usleep’ was not declared in this scope<a title=\"#1.-error:-'usleep'-was-not-declared-in-this-scope\" href=\"#1.-error:-'usleep'-was-not-declared-in-this-scope\"></a></h4>\n<p>Add <code>#include&lt;unistd.h&gt;</code> into all the error files.</p>\n<h4 id=\"2.-for-build_ros.sh,-dso-missing-from-command-line-...-makefile:129:-recipe-for-target-'all'-failed\">2. For <code>build_ros.sh</code>, DSO missing from command line … Makefile:129: recipe for target ‘all’ failed<a title=\"#2.-for-build_ros.sh,-dso-missing-from-command-line-...-makefile:129:-recipe-for-target-'all'-failed\" href=\"#2.-for-build_ros.sh,-dso-missing-from-command-line-...-makefile:129:-recipe-for-target-'all'-failed\"></a></h4>\n<p>Add this into <code>/Examples/ROS/ORB_SLAM2/CMakeLists/txt</code></p>\n<figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span>(LIBS</span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">-lboost_system <span class=\"comment\"># add this line!</span></span><br><span class=\"line\"><span class=\"comment\"># ...</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Then the building process should be finished successfully.</p>\n</blockquote>\n<h2 id=\"run-examples-with-kitti\">Run Examples with KITTI<a title=\"#run-examples-with-kitti\" href=\"#run-examples-with-kitti\"></a></h2>\n<p>Download KITTI dataset <a href=\"http://www.cvlibs.net/datasets/kitti/eval_odometry.php\" target=\"_blank\">here</a></p>\n<blockquote>\n<p>In this test, we used sequence 00 in the odometry data set (grayscale, 22 GB), for a <em><strong>stereo</strong></em> example.</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> $(your_catkin_workspace)/src/ORB_SLAM2</span><br><span class=\"line\">./Examples/Stereo/stereo_kitti Vocabulary/ORBvoc.txt Examples/Stereo/KITTI00-02.yaml $(PATH_TO_YOUR_DATASET_FOLDER)/dataset/sequences/00</span><br></pre></td></tr></table></figure>\n<h3 id=\"problems-encountered---slam.shutdown()-not-working\">Problems Encountered - SLAM.shutdown() Not Working<a title=\"#problems-encountered---slam.shutdown()-not-working\" href=\"#problems-encountered---slam.shutdown()-not-working\"></a></h3>\n<p>By doing the previous part, we can find that the <code>CameraTrajectory.txt</code> file is not generated after the whole sequence is over.</p>\n<p>After checking for <code>stereo_kitti.cc</code>, we can find that <code>SLAM.shutdown()</code> is not working properly.</p>\n<p>Hence, we should add 2 lines into <code>System.cc</code> like</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(mpViewer) &#123;</span><br><span class=\"line\">    mpViewer-&gt;<span class=\"built_in\">RequestFinish</span>();</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(!mpViewer-&gt;<span class=\"built_in\">isFinished</span>())</span><br><span class=\"line\">        <span class=\"built_in\">usleep</span>(<span class=\"number\">5000</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// add these 2 lines</span></span><br><span class=\"line\">    <span class=\"keyword\">delete</span> mpViewer;</span><br><span class=\"line\">    mpViewer = <span class=\"built_in\">static_cast</span>&lt;Viewer*&gt;(<span class=\"literal\">NULL</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>Make again in the build folder. Problem solved!</p>\n</blockquote>\n","next":{"title":"使用 CMake 建置 OpenCV 專案","link":"2022/09/02/22-09-02-cmake-tutorial"},"plink":"https://jinchuangtw.github.io/2022/10/28/22-10-28-ORBSLAM2-Test-log/","toc":[{"id":"download-and-build","title":"Download and Build","index":"1","children":[{"id":"building-problems-encountered","title":"Building Problems Encountered","index":"1.1"}]},{"id":"run-examples-with-kitti","title":"Run Examples with KITTI","index":"2","children":[{"id":"problems-encountered---slam.shutdown()-not-working","title":"Problems Encountered - SLAM.shutdown() Not Working","index":"2.1"}]}],"copyright":{"author":"Jin Chuang","link":"<a href=\"https://jinchuangtw.github.io/2022/10/28/22-10-28-ORBSLAM2-Test-log/\" title=\"ORB-SLAM2 Test Log (With KITTI Dataset on ROS)\">https://jinchuangtw.github.io/2022/10/28/22-10-28-ORBSLAM2-Test-log/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"},"reading_time":"269 words in 2 min"}